SELECT ifnull( t.dept_id, 0 ) dept_id, sum( t.device_num ) device_num, sum( t.device_using_num ) device_using_num, sum( t.device_no_using_num ) device_no_using_num, sum( t.device_no_accepted_num ) device_no_accepted_num, sum( t.device_scrap_num ) device_scrap_num, sum( t.device_spare_num ) device_spare_num, sum( t.device_seal_up_num) device_seal_up_num, sum( t.repair_doing_num ) repair_doing_num, sum( t.repair_wait_num ) repair_wait_num, sum( t.bad_num ) bad_num, sum( t.report_num ) report_num, sum( t.maintion_plan_num ) maintion_plan_num, sum( t.maintion_completed_num ) maintion_completed_num, sum( t.check_num ) check_num, t.device_usage, t.tenant_id FROM ( SELECT dept_id, sum( IF ( task_status = 1, 1, 0 )) repair_doing_num, sum( IF ( task_status = 0, 1, 0 )) repair_wait_num, 0 bad_num, sum( IF ( to_days( report_time ) = to_days( now()), 1, 0 )) report_num, 0 maintion_plan_num, 0 maintion_completed_num, 0 check_num, 0 device_num, 0 device_using_num, 0 device_no_using_num, 0 device_no_accepted_num, 0 device_scrap_num, 0 device_spare_num, 0 device_seal_up_num, device_usage, tenant_id FROM thing_maintain_task WHERE task_type = 2 AND is_deleted = 0 GROUP BY dept_id, device_usage, tenant_id UNION ALL SELECT dept_id, 0 repair_doing_num, 0 repair_wait_num, 0 bad_num, 0 report_num, count( task_status IN ( 0, 1, 2 )) maintion_plan_num, 0 maintion_completed_num, 0 check_num, 0 device_num, 0 device_using_num, 0 device_no_using_num, 0 device_no_accepted_num, 0 device_scrap_num, 0 device_spare_num, 0 device_seal_up_num, device_usage, tenant_id FROM thing_maintain_task WHERE plan_time BETWEEN date_format( now(), '%Y-%m-%d 00:00:00' ) AND date_format( now(), '%Y-%m-%d 23:59:59' ) AND task_type = 1 AND is_deleted = 0 GROUP BY dept_id, device_usage, tenant_id UNION ALL SELECT dept_id, 0 repair_doing_num, 0 repair_wait_num, 0 bad_num, 0 report_num, 0 maintion_plan_num, sum( IF ( task_type = 1, 1, 0 )) maintion_completed_num, sum( IF ( task_type = 0, 1, 0 )) check_num, 0 device_num, 0 device_using_num, 0 device_no_using_num, 0 device_no_accepted_num, 0 device_scrap_num, 0 device_spare_num, 0 device_seal_up_num, device_usage, tenant_id FROM thing_maintain_task WHERE task_type IN ( 0, 1 ) AND task_status = 2 AND is_deleted = 0 AND finish_time BETWEEN date_format( now(), '%Y-%m-%d 00:00:00' ) AND date_format( now(), '%Y-%m-%d 23:59:59' ) GROUP BY dept_id, device_usage, tenant_id UNION ALL SELECT dept_id, 0 repair_doing_num, 0 repair_wait_num, sum( IF ( device_status = 4, 1, 0 )) bad_num, 0 report_num, 0 maintion_plan_num, 0 maintion_completed_num, 0 check_num, count( 1 ) device_num, sum( IF ( device_status = 4 OR device_status = 0, 1, 0 )) device_using_num, sum( IF ( device_status = 1, 1, 0 )) device_no_using_num, sum( IF ( device_status = 2, 1, 0 )) device_no_accepted_num, sum( IF ( device_status = 3, 1, 0 )) device_scrap_num, sum( IF ( device_status = 5, 1, 0 )) device_spare_num, sum( IF (device_status = 6, 1,0)) device_seal_up_num, device_usage, tenant_id FROM thing_device_info WHERE is_deleted = 0 GROUP BY dept_id, device_usage, tenant_id ) t GROUP BY dept_id, device_usage, tenant_id;